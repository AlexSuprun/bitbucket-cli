---
title: AI Agent Integration
description: Use the Bitbucket CLI with Claude Code, opencode, and other AI coding assistants
---

import { Aside, Code, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

AI coding assistants can use the Bitbucket CLI to manage pull requests and repositories through natural conversation. Simply ask "Create a PR for this branch" and the AI handles the rest.

## Benefits

- **Natural language** - No need to memorize command flags
- **Intelligent chaining** - AI chains commands automatically
- **Team consistency** - Encode conventions for everyone
- **Faster workflows** - "Approve and merge PR 42" in one sentence

---

## Setup

Choose your AI agent:

<Tabs>
  <TabItem label="Claude Code">
    <Steps>
      1. **Create the skill directory:**
         ```bash
         mkdir -p .claude/skills/bb-cli
         ```

      2. **Create the skill file** at `.claude/skills/bb-cli/SKILL.md`:
         ````markdown
         ---
         name: bb-cli
         description: Execute Bitbucket Cloud CLI commands using `bb`. Use when creating, listing, editing, or managing pull requests, repositories, authentication, or configuration.
         allowed-tools: Bash(bb:*), Read, Grep, Glob
         ---

         # Bitbucket CLI (`bb`)

         Command-line interface for Bitbucket Cloud (@pilatos/bitbucket-cli).

         ## Quick Start

         ```bash
         bb auth status        # Check authentication
         bb pr list            # List open PRs
         bb pr create -t "..." # Create PR from current branch
         ```

         ## Requirements

         - `npm install -g @pilatos/bitbucket-cli`
         - Authenticated via `bb auth login` or env vars
         - Run from git repo with Bitbucket remote

         ## Commands

         See the full command reference in the skill file or run `bb --help`.

         **Key commands:**
         - `bb pr create/list/view/diff/checkout/approve/merge/decline/ready/comment`
         - `bb repo clone/create/list/view/delete`
         - `bb auth login/logout/status/token`
         - `bb config get/set/list`

         ## Workflows

         **Create PR:**
         ```bash
         git add . && git commit -m "feat: description"
         git push -u origin feature-branch
         bb pr create -t "feat: description" -b "Details"
         ```

         **Review and Merge:**
         ```bash
         bb pr checkout 42
         bb pr diff 42
         bb pr approve 42
         bb pr merge 42 --strategy squash --close-source-branch
         ```

         **Draft PR:**
         ```bash
         bb pr create -t "WIP" --draft
         bb pr ready 42  # Mark as ready later
         ```

         ## Tips

         - Context auto-detection: run from git repo with Bitbucket remote
         - JSON output: all commands support `--json`
         - Error codes: 0=success, 1xxx=auth, 2xxx=API, 3xxx=git, 5xxx=validation, 6xxx=context
         ````

      3. **Restart Claude Code** to load the skill

      4. **Test it:** Ask "List open PRs in this repo"
    </Steps>
    
    <Aside type="tip">
      Add to `~/.claude/skills/bb-cli/SKILL.md` for global availability across all projects.
    </Aside>
  </TabItem>
  
  <TabItem label="opencode">
    <Steps>
      1. **Create `AGENTS.md`** in your project root if it doesn't exist

      2. **Add the bb-cli section** to `AGENTS.md`:
         ````markdown
         ## Bitbucket CLI (bb)

         Use `bb` (@pilatos/bitbucket-cli) for Bitbucket operations.

         ### Installation

         ```bash
         npm install -g @pilatos/bitbucket-cli
         bb auth login
         ```

         ### Common Commands

         **Pull Requests:**
         - `bb pr list` - List open PRs
         - `bb pr create -t "title"` - Create PR from current branch
         - `bb pr view <id>` - View PR details
         - `bb pr diff <id>` - View diff
         - `bb pr checkout <id>` - Checkout locally
         - `bb pr approve <id>` - Approve PR
         - `bb pr merge <id>` - Merge PR
         - `bb pr ready <id>` - Mark draft as ready
         - `bb pr comment <id> -m "text"` - Add comment

         **Repositories:**
         - `bb repo list -w workspace` - List repos
         - `bb repo clone workspace/repo` - Clone

         **Configuration:**
         - `bb config set workspace myworkspace`
         - `bb config set repo myrepo`

         ### Tips

         1. Auto-detection works when in a git repo with Bitbucket remote
         2. Use `--json` for machine-readable output
         3. Squash merge: `bb pr merge <id> --strategy squash`
         4. Delete source branch: `--close-source-branch`

         ### Workflows

         **Create PR:**
         ```bash
         git add . && git commit -m "feat: desc"
         git push -u origin feature-branch
         bb pr create -t "feat: desc" -b "Details"
         ```

         **Review and Merge:**
         ```bash
         bb pr checkout 42
         bb pr approve 42
         bb pr merge 42 --strategy squash --close-source-branch
         ```
         ````

      3. **Run opencode** in your project directory

      4. **Test it:** Ask "What's the status of my PRs?"
    </Steps>
    
    <Aside type="tip">
      opencode automatically reads AGENTS.md. Keep it version-controlled for team consistency.
    </Aside>
  </TabItem>
  
  <TabItem label="Cursor">
    <Steps>
      1. **Create `.cursorrules`** in your project root:
         ````markdown
         ## Bitbucket CLI (bb)

         Use `bb` (@pilatos/bitbucket-cli) for Bitbucket operations.

         **Key Commands:**
         - `bb pr create/list/view/diff/checkout/approve/merge/decline/ready/comment`
         - `bb repo list/clone/view`
         - `bb config get/set/list`
         - `bb auth login/status`

         **Context:** Auto-detects workspace/repo from git remotes. Use `-w/-r` to override.

         **Output:** Use `--json` for machine-readable output.

         **Auth:** Requires `bb auth login` or `BB_USERNAME` + `BB_API_TOKEN` env vars.

         **Workflows:**
         - Create: Push branch → `bb pr create -t "title" -b "body"`
         - Review: `bb pr checkout <id>` → review → `bb pr approve <id>` → `bb pr merge <id> --strategy squash`
         ````

      2. **Open Cursor** in the project

      3. **Use Composer or Chat** with bb commands

      4. **Test it:** Ask "Create a PR for my current changes"
    </Steps>
  </TabItem>
</Tabs>

---

## Example Conversations

**Creating a PR:**
```
You: Create a PR for my current branch titled "Add user validation"
AI: [Runs: bb pr create -t "Add user validation"]
    ✅ Created PR #42
    https://bitbucket.org/workspace/repo/pull-requests/42
```

**Checking Open PRs:**
```
You: What PRs need my review?
AI: [Runs: bb pr list --json]
    Found 3 open PRs:
    • #42 - Add user validation (by john, 2 hours ago)
    • #41 - Fix login bug (by jane, 1 day ago)
    • #40 - Update dependencies (by bot, 3 days ago)
```

**Review Workflow:**
```
You: Review PR 42 and approve it if it looks good
AI: [Runs: bb pr view 42, bb pr diff 42]
    Changes look good. Approving...
    [Runs: bb pr approve 42]
    ✅ Approved PR #42.
```

**Draft PRs:**
```
You: Create a draft PR for my WIP
AI: [Runs: bb pr create -t "WIP: Feature" --draft]
    ✅ Created draft PR #43

You: Mark it ready for review
AI: [Runs: bb pr ready 43]
    ✅ Marked PR #43 as ready for review
```

---

## Team Conventions

Add team-specific rules to your AI instructions:

```markdown
### Branch Naming
- Features: `feat/<ticket>-<description>`
- Bugs: `fix/<ticket>-<description>`
- Hotfixes: `hotfix/<description>`

### PR Requirements
- All PRs need one approval
- Use draft PRs for work-in-progress
- Always squash merge features: `--strategy squash`
- Always delete source branches: `--close-source-branch`

### Review Process
1. bb pr checkout <id>
2. Review changes with bb pr diff <id>
3. bb pr approve <id>
4. bb pr merge <id> --strategy squash --close-source-branch
```

This ensures everyone follows the same workflow automatically.

---

## Security

<Aside type="caution">
  Never commit API tokens to version control. Use environment variables.
</Aside>

```bash
export BB_USERNAME=your-username
export BB_API_TOKEN=your-app-password
```

For Claude Code, limit permissions in the skill:
```yaml
allowed-tools: Bash(bb:*), Read, Grep, Glob  # Good - only bb commands
```

---

## Troubleshooting

| Issue | Solution |
|-------|----------|
| "Not authenticated" | Run `bb auth login` or set `BB_USERNAME` and `BB_API_TOKEN` |
| Commands still prompting | Claude Code: check `allowed-tools` includes `Bash(bb:*)` |
| "Could not determine repo" | Run from git repo with Bitbucket remote, or use `-w/-r` flags |
| AI using wrong syntax | Add more examples to your skill/instructions |
| opencode not finding commands | Ensure bb CLI is installed and in PATH |

---

## Related Guides

- [Scripting & Automation](/guides/scripting/)
- [CI/CD Integration](/guides/cicd/)
- [JSON Output](/reference/json-output/)
- [Error Codes](/reference/error-codes/)
- [Command Reference](/commands/pr/) - Full PR command documentation
